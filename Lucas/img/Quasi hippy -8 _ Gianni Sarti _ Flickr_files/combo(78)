YUI.add("subscription-history-list-models",function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-braintree-customerDetails-fetcher"].run(r,this.appContext)}},attributes:{subscriptions:{isListProxy:!0},oneTimePro:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-braintree-customerDetails-fetcher"]});YUI.add("flickr-braintree-customerDetails-fetcher",function(e,t){"use strict";function s(e){return{account_id:e.id}}require("hermes-core/flog")(t);e.namespace("ModelFetchers")["flickr-braintree-customerDetails-fetcher"]={run:function(i,r){var n=this,a=s(i);return e.Promise.all([r.callAPI("flickr.subscriptions.braintree.getCustomerDetails",a,!0),r.getModelRegistry("subscription-history-list-models"),r.getModelRegistry("subscription-history-models")]).then(function(e){return n._processResponse(e,i,r)},e.PromiseCatcher(t))},_processParams:s,_processResponse:function(t,s,i){var r,n=t[0],a=t[1],o=t[2],c={};(r=n.customerDetails.subscriptions)&&r instanceof Array&&(c.subscriptions=r.map(function(t){var s={};return t.status=parseInt(t.status,10),t.type=parseInt(t.type,10),s.startDate=1e3*t.startDate,s.billingScheduleMonths=t.billingScheduleMonths,s.nextBillingDate=1e3*t.nextBillingDate,s.effectiveEndDate=1e3*t.effectiveEndDate,s.type=t.type,s.paymentMethodId=t.paymentMethodId,s.status=t.status,s.amountBilled=t.amountBilled,s.transactions=t.transactions,s.prettyName=t.planInfo.prettyName,s.prettyNameDuration=t.planInfo.prettyNameDuration,s.pendingPrice=t.pendingPrice||void 0,s.paymentVendorType=t.paymentVendorType||void 0,e.Array.each(s.transactions,function(t){t.formattedCreateDate=e.moment(t.dateCreate,"X").format("MMM Do, YYYY"),t.isRefund=!1,3===parseInt(t.transactionType,10)&&(t.isRefund=!0)}),o.exists(t.id)?(o.setValues(t.id,s),o.proxy(t.id)):(s.id=t.id,o.add(s))}),n.customerDetails.paymentHistory&&(c.oneTimePro=n.customerDetails.paymentHistory.proStatus)),a.exists(s.id)?a.setValues(s.id,c):(c.id=s.id,a.add(c))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["subscription-history-models","subscription-history-list-models"]});YUI.add("subscription-history-models",function(t){function e(t){e.superclass.constructor.call(this,t)}var r=new t.SubscriptionsHelper;t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{update:function(e,r){return t.ModelUpdaters["flickr-subscriptions-changePlan-updater"].run({current_plan_type:r.type.prevVal,new_plan_type:r.type.newVal},this.appContext)},delete:function(e){return t.ModelDeletors["flickr-braintree-close-deletor"].run({subscription_id:e},this.appContext)}},attributes:{startDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},nextBillingDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},effectiveEndDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},billingScheduleMonths:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return 0}},type:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},paymentMethodId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyNameDuration:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},status:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},amountBilled:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},pendingPrice:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},transactions:{},paymentVendorType:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:r.getPaymentVendorType("braintree")}}})},"@VERSION@",{requires:["flickr-braintree-customerDetails-fetcher","flickr-subscriptions-changePlan-updater","flickr-braintree-close-deletor","subscriptions-helper"]});YUI.add("subscription-info-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-subscriptions-info-fetcher"].run(e,this.appContext)}},getFamilyInfoById:function(t,e){return this.getValue(t,"products").filter(function(t){return t.plan_id===e})},getPlanInfoById:function(t,e){return this.getValue(t,"products").filter(function(t){return t.planId===e})},getRawPlanPriceById:function(t,e){var n=this.getPlanInfoById(t,e);if(n&&n.length)return n[0].priceAfterTax},getFormattedPlanPriceById:function(t,e){var n=this.getPlanInfoById(t,e);if(n&&n.length)return n[0].formattedPriceAfterTax},getRawPlanDiscountPriceById:function(t,e){var n=this.getPlanInfoById(t,e);if(n&&n.length)return n[0].discountedPrice},attributes:{products:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-subscriptions-info-fetcher"]});YUI.add("flickr-subscriptions-info-fetcher",function(r,e){"use strict";function t(r){switch(parseInt(r,10)){case 1:return"1 Month";case 3:return"3 Months";case 12:return"1 Year";case 24:return"2 Years";default:return""}}r.namespace("ModelFetchers")["flickr-subscriptions-info-fetcher"]={run:function(t,n){var a,o=this,i=parseInt(n.flipper.getValue("enable-mocking-pro")||0,10);return a=n.flipper.isFlipped("enable-digital-river")&&t&&t.currency?n.callAPI("flickr.digital.river.subscriptions.getAvailableProducts",t):i>0?new r.Promise(function(r,e){r({planOptions:{productFamily:[{productFamilyName:"FlickrPro",canPurchaseProduct:i<4,planOption:[{planId:1,name:"FlickrPro3Months",durationMonths:3,price:6.95,prettyName:"Flickr Pro",prettyNameDuration:"3 Months"},{planId:2,name:"FlickrPro1Year",durationMonths:12,price:24.95,prettyName:"Flickr Pro",prettyNameDuration:"1 Year"},{planId:3,name:"FlickrPro2Year",durationMonths:24,price:44.95,prettyName:"Flickr Pro",prettyNameDuration:"2 Years"}]},{productFamilyName:"AdFree",canPurchaseProduct:4===i||6===i,planOption:[{planId:4,name:"AdFree1Year",durationMonths:12,price:49.99,prettyName:"Flickr Pro",prettyNameDuration:"1 Year"},{planId:6,name:"AdFree1Month",durationMonths:1,price:5.99,prettyName:"Flickr Pro",prettyNameDuration:"1 Month"}]},{productFamilyName:"Doublr",canPurchaseProduct:0,planOption:[{planId:5,name:"Doublr1Year",durationMonths:12,price:"499.99",prettyName:"Doublr",prettyNameDuration:"1 Year"}]},{productFamilyName:"FlickrNewPro",canPurchaseProduct:i>=7,planOption:[{planId:7,name:"ProV21Month",durationMonths:1,price:5.99,prettyName:"Flickr Pro",prettyNameDuration:"1 Month"},{planId:8,name:"ProV21Year",durationMonths:12,price:49.99,prettyName:"Flickr Pro",prettyNameDuration:"1 Year"}]}]}})}):n.callAPI("flickr.subscriptions.getSubscriptionInfo",t),r.Promise.all([a,n.getModelRegistry("subscription-info-models")]).then(function(r){return o._processResponse(r,t,n)},r.FetcherErrorLogger(e))},_processResponse:function(r,e,n){var a,o=r[0],i=r[1];if(a={id:e.id},a.products=[],n.flipper.isFlipped("enable-digital-river")&&e&&e.currency){var c;if(!o.planOptions||!o.planOptions.planInfo)return a;c=o.canPurchase,o.planOptions.planInfo.forEach(function(r){r.familyName="FlickrNewPro",r.formattedLength=t(r.durationMonths),r.canPurchase=c,r.price=r.priceAfterTax,r.discountedPrice&&(r.formattedDiscountedPrice=r.formattedDiscountedPrice,r.genericCouponData={couponCode:e.coupon_code,discountedPrice:r.discountedPrice,formattedDiscountedPrice:r.formattedDiscountedPrice,originalPrice:r.priceAfterTax}),a.products.push(r)})}else o.planOptions.productFamily.forEach(function(r){r.planOption.forEach(function(e){e.familyName=r.productFamilyName,e.formattedLength=t(e.durationMonths),e.canPurchase=r.canPurchaseProduct,a.products.push(e)})});i.addOrUpdate(a)}}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["subscription-info-models","api-helper"]});YUI.add("hermes-template-user-account-card",function(t,n){var e=t.Template.Handlebars.revive({1:function(t,n,e,a,l){var s;return'\t\t\t<div class="pro-since-container">\n'+(null!=(s=t.invokePartial(a["pro-badge"],n,{name:"pro-badge",hash:{badgeType:null!=(s=null!=n?n.user:n)?s.proBadge:s},data:l,indent:"\t\t\t\t",helpers:e,partials:a,decorators:t.decorators}))?s:"")+"\t\t\t</div>\n"},3:function(t,n,e,a,l){var s,i=null!=n?n:{},r=e.helperMissing;return'\t\t\t<div class="graph-container">\n\t\t\t\t<div class="symbol icon infinity-icon"></div>\n\t\t\t</div>\n\t\t\t<div class="details-container">\n\t\t\t\t<p class="space-used-text">\n\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{countString:(e.friendlyNumber||n&&n.friendlyNumber||r).call(i,null!=n?n.itemCount:n,{name:"friendlyNumber",hash:{},data:l}),itemCount:null!=n?n.itemCount:n,intlName:"common.ITEM_COUNT_FORMATTED"},data:l}))+"\n\t\t\t\t</p>\n\n"+(null!=(s=e.if.call(i,null!=n?n.isCancelledPro:n,{name:"if",hash:{},fn:t.program(4,l,0),inverse:t.program(6,l,0),data:l}))?s:"")+"\t\t\t</div>\n"},4:function(t,n,e,a,l){return'\t\t\t\t\t<a href="/account/upgrade/pro" class="re-subscribe-link">\n\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.RESUBSCRIBE_TO_PRO"},data:l}))+"\n\t\t\t\t\t</a>\n"},6:function(t,n,e,a,l){return'\t\t\t\t\t<a href="/upload" class="upload-link">\n\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.UPLOAD_YOUR_PHOTOS"},data:l}))+"\n\t\t\t\t\t</a>\n"},8:function(t,n,e,a,l){var s;return null!=(s=e.if.call(null!=n?n:{},null!=n?n.showOverLimitWarning:n,{name:"if",hash:{},fn:t.program(9,l,0),inverse:t.program(11,l,0),data:l}))?s:""},9:function(t,n,e,a,l){var s=null!=n?n:{},i=e.helperMissing,r=t.escapeExpression;return'\t\t\t\t<div class="graph-container">\n\t\t\t\t\t<div class="symbol warning-symbol"><span class="exclamation">!</span></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="details-container">\n\t\t\t\t\t<p class="space-used-text over-limit-warning">\n\t\t\t\t\t\t'+r((e.preventOrphans||n&&n.preventOrphans||i).call(s,(e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{limit:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemLimit:n,{name:"friendlyNumber",hash:{},data:l}),count:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemCount:n,{name:"friendlyNumber",hash:{},data:l}),intlName:"account-menu.ITEM_LIMIT_EXCEEDED"},data:l}),{name:"preventOrphans",hash:{},data:l}))+'\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<span class="over-limit-warning-links">\n\t\t\t\t\t\t<a role="button" class="over-limit-learn-button">'+r((e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:l}))+'</a>\n\t\t\t\t\t\t<a href="/account/upgrade/pro">'+r((e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.GET_PRO"},data:l}))+"</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n"},11:function(t,n,e,a,l){var s,i=null!=n?n:{};return'\t\t\t\t<div class="graph-container">\n\t\t\t\t\t<div class="symbol graph"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="details-container">\n'+(null!=(s=e.if.call(i,null!=n?n.limitReached:n,{name:"if",hash:{},fn:t.program(12,l,0),inverse:t.program(14,l,0),data:l}))?s:"")+"\n"+(null!=(s=e.if.call(i,null!=n?n.isUnder500:n,{name:"if",hash:{},fn:t.program(16,l,0),inverse:t.program(18,l,0),data:l}))?s:"")+"\t\t\t\t</div>\n"},12:function(t,n,e,a,l){var s=null!=n?n:{},i=e.helperMissing;return'\t\t\t\t\t\t<p class="space-used-text limit-reached">\n\t\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{limit:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemLimit:n,{name:"friendlyNumber",hash:{},data:l}),intlName:"account-menu.ITEM_LIMIT_REACHED"},data:l}))+"\n\t\t\t\t\t\t</p>\n"},14:function(t,n,e,a,l){var s=null!=n?n:{},i=e.helperMissing;return'\t\t\t\t\t\t<p class="space-used-text">\n\t\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||i).call(s,{name:"intlMessage",hash:{limit:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemLimit:n,{name:"friendlyNumber",hash:{},data:l}),count:(e.friendlyNumber||n&&n.friendlyNumber||i).call(s,null!=n?n.itemCount:n,{name:"friendlyNumber",hash:{},data:l}),intlName:"account-menu.ITEM_COUNT_OF_LIMIT"},data:l}))+"\n\t\t\t\t\t\t</p>\n"},16:function(t,n,e,a,l){return'\t\t\t\t\t\t<a href="/photos/upload/">\n\t\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.UPLOAD_YOUR_PHOTOS"},data:l}))+" \n\t\t\t\t\t\t</a>\n"},18:function(t,n,e,a,l){return'\t\t\t\t\t\t<a href="/account/upgrade/pro" class="unlimited-storage-link">\n\t\t\t\t\t\t\t'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.GET_UNLIMITED_UPLOADS"},data:l}))+"\n\t\t\t\t\t\t</a>\n"},20:function(t,n,e,a,l){return" unread-messages "},compiler:[7,">= 4.0.0"],main:function(t,n,e,a,l){var s,i=null!=n?n:{},r=e.helperMissing,c=t.escapeExpression,u=t.lambda;return'<div class="account-card-container">\n\t<section class="greeting-section">\n\t\t<h4>'+c((e.renderTrustedMarkup||n&&n.renderTrustedMarkup||r).call(i,null!=(s=null!=n?n.greeting:n)?s.hello:s,{name:"renderTrustedMarkup",hash:{},data:l}))+"</h4>\n\n"+(null!=(s=e.if.call(i,null!=(s=null!=n?n.user:n)?s.isPro:s,{name:"if",hash:{},fn:t.program(1,l,0),inverse:t.noop,data:l}))?s:"")+"\n\t\t<p>"+c(u(null!=(s=null!=n?n.greeting:n)?s.caption:s,n))+'</p>\n\n\t</section>\n\t<section class="storage-section">\n'+(null!=(s=e.if.call(i,null!=(s=null!=n?n.user:n)?s.isPro:s,{name:"if",hash:{},fn:t.program(3,l,0),inverse:t.program(8,l,0),data:l}))?s:"")+'\t</section>\n\t<section class="menu-section">\n\t\t<ul>\n\t\t\t<li class="'+(null!=(s=e.if.call(i,null!=n?n.hasUnreadMessages:n,{name:"if",hash:{},fn:t.program(20,l,0),inverse:t.noop,data:l}))?s:"")+'" >\n\t\t\t\t<a href="/mail">\n\t\t\t\t\t'+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.FLICKRMAIL"},data:l}))+"\n\t\t\t\t\t<span>"+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{count:(e.formatNumber||n&&n.formatNumber||r).call(i,null!=n?n.unreadCount:n,{name:"formatNumber",hash:{},data:l}),intlName:"notifications.FLICKR_MAIL_COUNT_PAREN"},data:l}))+'</span>\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<a href="/account">'+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.SETTINGS"},data:l}))+'</a>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<a href="//help.flickr.com/">'+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.HELP"},data:l}))+'</a>\n\t\t\t</li>\n\t\t\t<li>\n\t\t\t\t<a href="/logout.gne?csrf='+c(u(null!=(s=null!=n?n.user:n)?s.csrf:s,n))+'">'+c((e.intlMessage||n&&n.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.LOG_OUT"},data:l}))+"</a>\n\t\t\t</li>\n\t\t</ul>\n\t</section>\n</div>\n"},usePartial:!0,useData:!0}),a={};t.Array.each(["pro-badge"],function(n){var e=t.Template.get("hermes/"+n);e&&(a[n]=e)}),t.Template.register("hermes/user-account-card",function(n,l){return l=l||{},l.partials=l.partials?t.merge(a,l.partials):a,e(n,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge"]});YUI.add("easing-functions",function(n){"use strict";n.EasingFunctions={linear:function(n){return n},easeInQuad:function(n){return n*n},easeOutQuad:function(n){return n*(2-n)},easeInOutQuad:function(n){return n<.5?2*n*n:(4-2*n)*n-1},easeInCubic:function(n){return n*n*n},easeOutCubic:function(n){return--n*n*n+1},easeInOutCubic:function(n){return n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1},easeInQuart:function(n){return n*n*n*n},easeOutQuart:function(n){return 1- --n*n*n*n},easeInOutQuart:function(n){return n<.5?8*n*n*n*n:1-8*--n*n*n*n},easeInQuint:function(n){return n*n*n*n*n},easeOutQuint:function(n){return 1+--n*n*n*n*n},easeInOutQuint:function(n){return n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n},easeOutElastic:function(n){return(.04-.04/n)*Math.sin(25*n)+1},easeInElastic:function(n){return.04*n/--n*Math.sin(25*n)},easeInOutElastic:function(n){return(n-=.5)<0?(.02+.01/n)*Math.sin(50*n):(.02-.01/n)*Math.sin(50*n)+1}}},"@VERSION@",{requires:[]});