YUI.add("flickr-photos-licenses-setLicense-updater",function(e,s){"use strict";e.namespace("ModelUpdaters")["flickr-photos-licenses-setLicense"]={run:function(o,n){var t={};return o.fullResponse?(t.photo_ids=o.photoId,t.full_response=1):t.photo_id=o.photoId,t.license_id=o.license,n.callAPI("flickr.photos.licenses.setLicense",t).then(function(e){if("errors"in e)return e.api="setLicense",e},function(e){throw o.fullResponse&&(e.photoIds=o.photoId,e.returnApi="setLicense"),e}).then(null,e.FetcherErrorLogger(s))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photos-setSafetyLevel-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-photos-setSafetyLevel"]={run:function(o,r){var s={};return o.fullResponse?(s.photo_ids=o.photoId,s.full_response=1):s.photo_id=o.photoId,s.safety_level=o.safetyLevel+1,r.callAPI("flickr.photos.setSafetyLevel",s).then(function(e){if("errors"in e)return e.api="setSafety",e},function(e){throw o.fullResponse&&(e.photoIds=o.photoId,e.returnApi="setSafety"),e}).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("photo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,i){var r=[];return("title"in i||"description"in i)&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:i.title?i.title.newVal:this.getValue(t,"title"),description:i.description?i.description.newVal:this.getValue(t,"description")},this.appContext)),"license"in i&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:i.license.newVal},this.appContext)),"safetyLevel"in i&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:i.safetyLevel.newVal},this.appContext)),e.Promise.all(r)},batchUpdate:function(t,i){var r=[];return"safetyLevel"in i&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:parseInt(i.safetyLevel,10),fullResponse:1},this.appContext)),"title"in i&&"description"in i?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:i.title,description:i.description,fullResponse:1},this.appContext)):"title"in i?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:i.title,fullResponse:1},this.appContext)):"description"in i&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,description:i.description,fullResponse:1},this.appContext)),"license"in i&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:i.license,fullResponse:1},this.appContext)),e.Promise.all(r)}},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,getSizeForCanvas:e.PhotoModelHelper.getSizeForCanvas,getGuestpass:function(t){var i=this;return new e.Promise(function(e,r){i.getValue(t,"guestpass")?e():i.appContext.callAPI("flickr.sharing.createGuestpass",{photo:t}).then(function(r){i.setValue(t,"guestpass",r.guestpass.url),e()})})},canVr:function(t){var i,r=!1;return this.appContext.flipper.isFlipped("enable-vr")?(this&&(i=this.getValue(t,"aspectRatio"))&&i>=1.99&&i<=2.01&&(r=!0),r?e.Promise.all([this.appContext.callAPI("flickr.vr.isEquirectangular",{photo_id:t})]).then(function(t){return e.Promise.resolve(!!t[0].is_equirectangular)}):e.Promise.resolve(!1)):e.Promise.resolve(!1)},attributes:{title:e.PhotoModelHelper.attributes.title,description:e.PhotoModelHelper.attributes.description,mediaType:e.PhotoModelHelper.attributes.mediaType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,canPublicComment:e.PhotoModelHelper.attributes.canPublicComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,similaritySearchURL:e.PhotoModelHelper.attributes.similaritySearchURL,basicSimilaritySearchURL:e.PhotoModelHelper.attributes.basicSimilaritySearchURL,owner:{isModel:!0},engagement:{isModel:!0},isHD:{},secret:{},canAddMeta:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},oWidth:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},oHeight:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},safetyLevel:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},guestpass:{},sizesForAlbum:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(t){var i=this.getValue(t,"sizes");return e.Object.each(i,function(e,t){e.src=e.url}),i}},stats:{isModel:!0},visibilitySource:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:1},isVideoPending:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVideoFailed:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","photo-model-helper","flickr-photos-getInfo-fetcher","flickr-photos-setPerms-updater","flickr-photos-setMeta-updater","flickr-photos-licenses-setLicense-updater","flickr-photos-setSafetyLevel-updater","attribute-helpers"]});YUI.add("flickr-groups-pools-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-groups-pools-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.groups.pools.getContext",this._processParams(t),!0),s.getModelRegistry("group-pool-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 2===e.code&&"Photo not in pool"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){var t={photo_id:o.photoId,extras:e.APIHelper.request.getRebootPhotoExtras()+",datecreate",num_prev:o.numNext,num_next:o.numPrev,get_group_info:1};if(o.id)t.group_id=o.id;else{if(!o.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");t.group_path_alias=o.pathAlias}return t},_processResponse:function(o,t){var s,r,n,p,i,a,l=o[0],h=o[1],g=o[2],d=o[3],u=o[4],m=o[5],c=[],x=[],y=g.proxy(t.photoId),M=[];return s=l.prevphotos,r=l.nextphotos,x=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:d,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:d,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),a=h.getValue(t.id,"photoContextList"),p=!!a.hasMinBoundary&&a.hasMinBoundary(),i=!!a.hasMaxBoundary&&a.hasMaxBoundary(),n=a.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:y,next:x,prev:c.reverse(),current:n,hasMin:p,hasMax:i,numNext:t.numNext,numPrev:t.numPrev}),h.setValue(t.id,"photoContextList",M),{next:x,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","photo-engagement-models","photo-stats-models","group-models"]});YUI.add("flickr-groups-pools-add-creator",function(o,e){"use strict";o.namespace("ModelCreators")["flickr-groups-pools-add"]={run:function(t,r){var p=this,s=this._processParams(t),l=t.registryName||"group-pool-models",u={apiResponse:r.callAPI("flickr.groups.pools.add",s),groupPoolModel:r.getModel(l,t.groupID),photoModel:r.getModel("photo-models",t.photoID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")};return t.unfilteredGroupId=s.group_id,"group-pool-models"!==l&&(u.unfilteredGroupPoolModel=r.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(u).then(function(o){return p._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoID,group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModel,p=o.photoModel,s=o.photoGroupsModelRegistry,l=o.photoContextsModelRegistry,u=o.unfilteredGroupPoolModel;if("ok"===t.stat)return r&&!r.hasPhoto(p.getValue("id"))&&(r.addPhotoLocal(p),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")+1)),u&&u.hasPhoto(p.getValue("id"))&&u.addPhotoLocal(p),s.exists(e.photoID)&&!s.getValue(e.photoID,"groups").getFromListByID(e.unfilteredGroupId)&&(s.getValue(e.photoID,"groups").unshift(r),s.setValue(e.photoID,"total",s.getValue(e.photoID,"total")+1)),l.exists(e.photoID)&&!l.getValue(e.photoID,"contexts").getFromListByID(e.unfilteredGroupId)&&(l.setValue(e.photoID,"totalGroups",l.getValue(e.photoID,"totalGroups")+1),l.getValue(e.photoID,"contexts").push(r)),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-pools-remove-deletor",function(o,e){"use strict";o.namespace("ModelDeletors")["flickr-groups-pools-remove"]={run:function(t,r){var s=this,p=this._processParams(t),l=t.registryName||"group-pool-models",u={apiResponse:r.callAPI("flickr.groups.pools.remove",p),groupPoolModelRegistry:r.getModel(l,t.groupID),photoModelRegistry:r.getModel("photo-models",t.photoID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")};return t.unfilteredGroupId=p.group_id,"group-pool-models"!==l&&(u.unfilteredGroupPoolModelRegistry=r.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(u).then(function(o){return s._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoID,group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModelRegistry,s=o.photoModelRegistry,p=o.photoGroupsModelRegistry,l=o.photoContextsModelRegistry,u=o.unfilteredGroupPoolModelRegistry;if("ok"===t.stat)return l.exists(e.photoID)&&l.getValue(e.photoID,"contexts").getFromListByID(e.unfilteredGroupId)&&(l.setValue(e.photoID,"totalGroups",l.getValue(e.photoID,"totalGroups")-1),l.getValue(e.photoID,"contexts").removeFromList(e.unfilteredGroupId)),p.exists(e.photoID)&&p.getValue(e.photoID,"groups").getFromListByID(e.unfilteredGroupId)&&(p.setValue(e.photoID,"total",p.getValue(e.photoID,"total")-1),p.getValue(e.photoID,"groups").removeFromList(e.unfilteredGroupId)),r&&(r.hasPhoto(s.getValue("id"))&&r.removePhotoLocal(s),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")-1)),u&&u.hasPhoto(s.getValue("id"))&&u.removePhotoLocal(s),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-invite-photo-invite-creator",function(o,t){"use strict";o.namespace("ModelCreators")["flickr-groups-invite-photo-invite"]={run:function(e,i){var r={},p=o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID);return r.photo_id=e.photoID,r.group_id=p,o.Promise.all([i.callAPI("flickr.groups.invite.photo.invite",r),i.getModel("group-pool-models",p),i.getModelRegistry("photo-group-invitation-models"),i.getModelRegistry("photo-group-invitations-models")]).then(function(o){var t,r,n,s=o[0],l=o[1],u=o[2],d=o[3];if("ok"===s.stat)return t=[e.photoID,p].join("-"),r={id:t,photoId:e.photoID,groupId:p,invitedBy:i.getViewer().nsid},n=u.exists(t)?u.proxy(t):u.add(r),d.exists(e.photoID)&&!d.getValue(e.photoID,"invitations").getFromListByID(t)&&(d.getValue(e.photoID,"groups").prependToList(l),d.getValue(e.photoID,"invitations").prependToList(n),d.setValue(e.photoID,"total",d.getValue(e.photoID,"total")+1)),l},o.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});