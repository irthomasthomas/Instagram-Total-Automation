YUI.add("add-comment-view",function(e,t){var n=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.config=this.params.addCommentConfig,this.signedIn=this.appContext.getViewer().signedIn,this.commentingEnabled=!0,this.addCommentText=this.config.addCommentText||this.intlMessage({intlName:"comments.ADD_A_COMMENT"})},loadState:function(){var t=this,n=[this.appContext.getModelRegistry(this.config.commentModelRegistryName).then(function(e){t.commentModelRegistry=e})];return this.signedIn&&n.push(this.appContext.getModel("person-models",{id:this.appContext.getViewer().nsid}).then(function(e){t.userModel=e})),this.config.galleryId&&n.push(this.appContext.getModel("gallery-info-models",{id:this.config.galleryId}).then(function(e){t.galleryInfoModel=e})),this.params.photoId&&n.push(this.appContext.getModel("photo-models",{id:this.params.photoId}).then(function(e){t.photoModel=e,t.commentingEnabled=!t.signedIn||t.photoModel.getValue("canComment")})),e.Promise.all(n)},buildContainer:function(){this.setContainerWithTemplate("add-comment-view",{user:this.signedIn?this.userModel.toJSON():null,signedIn:this.signedIn,placeholderText:this.getPlaceholderText(),commentingEnabled:this.commentingEnabled})},activate:function(){var t=this.get("container");this.commentButton=t.one(".comment-button"),this.commentField=t.one(".comment-field"),this.commentButtonsContainer=t.one(".buttons.comment-buttons"),this.signedIn||(this.signedOutIcon=t.one(".signed-out-icon"),this.registerEventHandler(this.signedOutIcon.on("mousedown",this.handleCommentFocus.bind(this)))),this.commentingEnabled&&(this.registerEventHandler(this.commentButton.on("click",this.handleAddCommentClick.bind(this))),this.registerEventHandler(this.commentField.on("focus",this.handleCommentFocus.bind(this))),this.registerEventHandler(e.on("click",this.handleContainerClick.bind(this))),t.ancestor(".fluid-droparound-view")&&setTimeout(function(){t.one(".comment-area").focus()},0))},getPlaceholderText:function(){return this.signedIn?this.config.addCommentText:"en-us"===this.appContext.lang.toLowerCase()?this.intlMessage({intlName:"comments.LOGIN_TO_COMMENT"}):this.config.addCommentText},handleAddCommentClick:function(e){this.addComment(this.commentField.get("value"))},addComment:function(t){var i=this;if(t)return this.commentField.set("value",""),this.commentButton.setAttribute("disabled"),this.commentField.removeClass("focused"),this.commentButtonsContainer.addClass("hidden"),this.fakeAddComment=function(){return e.Promise.resolve({comment:{id:"72157688007210754-tmpp",content:t,contentSecure:t},stat:"ok"})},i.fire("subviewViewEvent",{eventName:"commentAddLoading",isLoading:!0}),this.addCommentCall(t).then(function(e){i.fire("subviewViewEvent",{eventName:"commentAdded",commentModel:e}),i.commentButton.removeAttribute("disabled")}).catch(function(e){i.commentButton.removeAttribute("disabled"),i.fire("subviewViewEvent",{eventName:"commentAddLoading",isLoading:!1}),n.error("Error adding gallery comment",{err:e})})},addCommentCall:function(e){return"gallery"===this.params.addCommentConfig.type?this.addGalleryComment(e):"photo"===this.params.addCommentConfig.type?this.addPhotoComment(e):void 0},handleCommentFocus:function(e){this.signedIn?(this.commentField.addClass("focused"),this.commentButtonsContainer.removeClass("hidden")):(e&&e.preventDefault(),this.showSignUpModal())},addReplyMessage:function(t,n){var i="",o=this.commentField.get("value");this.signedIn?(o.length>0&&(i+=o+" "),i+="["+e.url("/photos/"+t)+"] ",this.handleCommentFocus(!0),this.commentField.focus(),this.commentField.set("value",i),n&&this.commentField.scrollIntoView()):this.showSignUpModal()},showSignUpModal:function(){var t,n=e.config.win.location.href,i=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),o=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"});e.fire("addComment:showingSignupModal"),(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-upload",signUpTitle:i,signUpMessage:o,beaconPrefix:"addComment"})).on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("",{postLoginUrl:n})}),t.on("signInClick",function(t){e.SigninHelper._redirectToSignin("",{postLoginUrl:n})}),t.show()},handleContainerClick:function(e){this.checkCommentUnfocus(e)},checkCommentUnfocus:function(e){var t=e.target;t.ancestor(".add-comment-view",!0)||t.ancestor(".comment-action-reply-button",!0)||(this.commentButtonsContainer.addClass("hidden"),this.commentField.removeClass("focused"))},addGalleryComment:function(e){return this.commentModelRegistry.remoteCreate({galleryId:this.galleryInfoModel.getValue("id"),galleryOwnerId:this.galleryInfoModel.getValue("owner").getValue("id"),commentText:e,authorId:this.userModel.getValue("id")})},addPhotoComment:function(e){return this.commentModelRegistry.remoteCreate({photoId:this.params.photoId,commentText:e})},focusCommentBox:function(){this.commentField&&this.commentField.focus()}})},"@VERSION@",{requires:["flickr-view","signup-modal-view","hermes-template-add-comment-view"],langBundles:["gallery","photo-page-scrappy","stats","comments","common"]});YUI.add("hermes-lang-stats",function(e,t){e.Intl.add("hermes/stats","en-US",{STATS:["Stats"],NUMBER:[{type:"number",valueName:"num"}],NUMBER_VIEWS:[{type:"number",valueName:"num"}," views"],NUMBER_FAVES:[{type:"number",valueName:"num"}," faves"],NUMBER_COMMENTS:[{type:"number",valueName:"num"}," comments"],VIEW_COUNTS:["View Counts"],SO_FAR_TODAY:["So far today"],SO_FAR_TODAY_DOT_DOT_DOT:["So far today..."],YESTERDAY:["Yesterday"],ALL_TIME:["All time"],PHOTOS_AND_VIDEOS:["Photos and Videos"],PHOTOS:["Photos"],VIDEOS:["Videos"],PHOTOSTREAM:["Photostream"],ALBUMS:["Albums"],COLLECTIONS:["Collections"],GALLERIES:["Galleries"],TOTAL:["Total"],TOP_PHOTOS_AND_VIDEOS:["Top photos and videos"],CONTENT_BREAKDOWN:["Content Breakdown <span>(",{type:"number",valueName:"num"}," items)</span>"],VIEWS:["Views"],ALL_TIME_VIEWS:["All Time views"],ALL_TIME_FAVES:["All time faves"],ALL_TIME_COMMENTS:["All time comments"],DATE:["Date"],INTERESTINGNESS:["Interestingness"],FAVORITES:["Favorites"],COMMENTS:["Comments"],RECENT_VIEWS:["Recent views"],RECENT_FAVES:["Recent faves"],RECENT_COMMENTS:["Recent comments"],BACK_TO_STATS:["Back to Stats"],SOURCE_BREAKDOWN:["Source breakdown"],ALL_PHOTO_AND_VIDEOS_LINK:["All photos and videos"],VISITS:["Visits"],PRO_UNTIL_DATE:["PRO until ","${date}"],PRO_SINCE_DATE:["PRO since ","${date}"],PRO_SINCE_MONTHYEAR:["PRO since ",{type:"date",valueName:"intlDate",format:"monthYear"}],PRO_UNTIL_MONTHYEAR:["PRO until ",{type:"date",valueName:"intlDate",format:"monthYear"}],LEARN_MORE:["Learn more"],CURRENT_STATS_DATE:["Stats are shown in GMT, where it's currently ","${time}"," on ","${date}"],CURRENT_STATS_LONGDATE:["Stats are shown in GMT, where it's currently ","${time}"," on ",{type:"date",valueName:"intlDate",format:"long"}],SPACE_USED_LIMITED:["${used}"," of ","${total}"," used"],SPACE_USED_UNLIMITED:["${used}"," of unlimited used"],PUBLIC:["Public"],FRIENDS:["Friends"],FAMILY:["Family"],FF:["Friends and Family"],PRIVATE:["Private"],TAGGED:["Tagged"],GEOTAGGED:["Geotagged"],IN_ALBUMS:["In albums"],IN_GROUPS:["In groups"],VIEWED:["Viewed"],FAVED:["Faved"],COMMENTED:["Commented"],NO_SOURCES_TODAY:["No sources for this day"],NO_VIEWS_TODAY:["No photos have been viewed today"],PERCENTAGE_OF_VIEWS:[{type:"number",valueName:"num"},"% of views"],PERCENTAGE_OF_FAVES:[{type:"number",valueName:"num"},"% of faves"],PERCENTAGE_OF_COMMENTS:[{type:"number",valueName:"num"},"% of comments"],TODAY:["Today"],SOURCES:["Sources"],LOAD_MORE:["Load more"],NEXT:["Next"],PREVIOUS:["Previous"],MEDIA:["Media"],VISIBILITY:["Visibility"],ALPHA_LABEL:["Stats Alpha"],BETA_LABEL:["Stats Beta"],SHOW_ALL:["Show all"],PHOTO_STATS:["Photo stats"],EXPAND_ALL:["Expand all"],COLLAPSE_ALL:["Collapse all"],NO_PHOTO_STATS_AVAILABLE:["No stats available for this photo"],NO_RECENT_PHOTO_STATS_AVAILABLE:["No recent stats available for this photo"],WELCOME_TO_STATS:["Welcome to stats"],WELCOME_MODAL_SCREEN_1:["Easily see your all time data"],WELCOME_MODAL_SCREEN_2:["More powerful navigation"],WELCOME_MODAL_SCREEN_3:["More meaningful data, categories, and social sources"],WELCOME_MODAL_SCREEN_2_QUICK:["Quickly access your data with improved navigation"],WORKING_ON_IT:["We're working on it"],STATS_LOADING:["We're having some trouble displaying stats at the moment. Please try again."],"404_STATS_ONLY_YOU":["Sorry, you can’t see someone else’s stats."]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-comments",function(o,e){o.Intl.add("hermes/comments","en-US",{LOADING:["Loading"],MORE:["more"],ERROR_LOADING_COMMENTS:["Error loading comments"],COULDNT_POST_COMMENT:["We couldn't post your comment"],COULDNT_GET_MORE_COMMENTS:["We couldn't get more comments"],CONFIRM_DELETE:["Confirm Delete"],YES_CONFIRM_DELETE:["Yes, Delete It"],ARE_YOU_SURE_DELETE:["Are you sure you want to delete this comment?"],COULDNT_DELETE_COMMENT:["We couldn't delete your comment"],ERROR:["Error!"],NO_COMMENTS:["No comments"],ADD_A_COMMENT:["Add a comment"],LOGIN_TO_COMMENT:["Login to comment"],MUST_BE_LOGGED_IN_TO_COMMENT:["You must be logged in to post a comment"],LOADING_COMMENTS:["Loading comments..."],SEE_MORE:["See more"],SEE_MORE_LINK:['... <a href="',"${photoUrl}",'">Read more</a>'],SIGNUP_MODAL_TITLE:["Comment on this photo!"],SIGNUP_MODAL_MESSAGE:["Join Flickr to leave a comment on this photo"],VIEW_COMMENTS:["View Comments"],COMMENTING_DISABLED:["Commenting is disabled for this photo."],VIEW_ON_PHOTO_PAGE:["View all comments on the photo page"],ADD_GALLERY_COMMENT:["Add a comment about this gallery"],ADD_PHOTO_COMMENT:["Add a comment about this ",{type:"select",valueName:"mediaType",options:{photo:["photo"],video:["video"],other:["photo"]}}]})},"@VERSION@",{requires:["intl"]});YUI.add("comment-list-view",function(e,t){var n=require("hermes-core/flog")(t);e.namespace("Views")["comment-list-view"]=e.Base.create("comment-list-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.modelConfig=e.commentListConfig,this.perPage=this.modelConfig.perPage||16,this.firstPerPage=this.modelConfig.firstPerPage||16,this.commentsPage=0,this.renderedCommentModels=[],this.isSubjectOwner=!1},activate:function(){var e=this.get("container");return e.addClass("comment-list-view"),this.commentsListNode=e.one(".comment-list"),this.registerEventHandler(this.commentsListNode.delegate("click",this.handleCommentActionClick.bind(this),".comment-actions")),this.loadComments()},resetComments:function(){return this.renderedCommentModels=[],this.commentsPage=0,this.commentsListNode.set("innerHTML",""),this.loadComments()},loadComments:function(){var t=this,o=t.appContext.getViewer().nsid,i=t.appContext.getViewer().signedIn,m=[this.appContext.getModelRegistry(this.modelConfig.commentModelRegistryName).then(function(e){t.commentModelRegistry=e}),this.appContext.getModel(this.modelConfig.listRegistryName,{id:this.modelConfig.modelId}).then(function(e){t.listModel=e})];switch(this.modelConfig.listRegistryName){case"gallery-info-models":m.push(this.appContext.getModel(this.modelConfig.listRegistryName,{id:this.modelConfig.modelId}).then(function(e){t.isSubjectOwner=i&&o===e.getValue("owner").getValue("nsid")}));break;case"photo-comments-models":m.push(this.appContext.getModel("photo-models",this.modelConfig.modelId).then(function(e){t.isSubjectOwner=o===e.getValue("owner").getValue("nsid")})),m.push(this.appContext.getModel("photo-engagement-models",this.params.photoId).then(function(e){t.engagementModel=e}))}return e.Promise.all(m).then(function(e){var n=t.listModel.getValue(t.modelConfig.collectionName).getList();return t.commentsPage=Math.ceil(n.length/t.perPage),"-1"===t.listModel.getValue(t.modelConfig.listRegistryContinuationName)&&(t.endOfComments=!0),0!==n.length?t.updateComments(n):t.getComments()}).then(function(){var e=t.get("container").all("img.notsowide"),n=e._nodes.length,o=0;0===n?t.handleLoadCommentsComplete():e.on(["load","error"],function(e){++o===n&&t.handleLoadCommentsComplete()})}).catch(function(e){n.error("Error getting info",{err:e})})},getComments:function(){var t,o=this;return this.endOfComments?e.Promise.resolve():(this.isFetchingComments=!0,"gallery"===this.modelConfig.type?t=this.getGalleryComments():"photo"===this.modelConfig.type&&(t=this.getPhotoComments()),t.then(function(){o.isFetchingComments=!1}).catch(function(e){n.error("Error getting comments",{err:e}),o.isFetchingComments=!1}))},getGalleryComments:function(){var e=this,t=this.notFirstPage?this.perPage:this.firstPerPage,n=this.listModel.getValue(e.modelConfig.collectionName).getList(),o=this.renderedCommentModels.length,i=[];if(n.length>o+t){for(var m=o;m<o+t;m++)i.push(n[m]);return e.updateComments(i)}return this.listModel.getCommentsByContinuation(t).then(function(t){return e.notFirstPage=!0,"-1"===e.listModel.getValue(e.modelConfig.listRegistryContinuationName)&&(e.endOfComments=!0),e.updateComments(t)})},getPhotoComments:function(){var t=this;return 0===this.engagementModel.getValue("commentCount")?(this.endOfComments=!0,e.Promise.resolve()):this.listModel.getValue(this.modelConfig.collectionName).getRange({offset:this.listModel.getValue(this.modelConfig.collectionName).getList().length,limit:this.perPage}).then(function(e){return t.commentsPage++,e.length<16&&(t.endOfComments=!0),t.updateComments(e)})},getMoreComments:function(){var t=this;return this.endOfComments?e.Promise.resolve():(this.showCommentLoading(!0),this.getComments().then(function(){t.showCommentLoading(!1)}))},showBalls:function(t){this.balls||(this.balls=e.Node.create('<li class="loading-balls"></li>'),this.balls.setHTML(this.templates("flickr-balls")({}))),t?(this.balls.addClass("bottom"),this.commentsListNode.append(this.balls)):this.commentsListNode.prepend(this.balls)},hideBalls:function(){this.balls&&(this.balls.removeClass("bottom"),this.balls.remove())},appendNewComment:function(t){var n=this,o=Object.assign(t.toJSON(),{appContext:this.appContext}),i=new e.Views["comment-item-view"](o);i.initialize(o).then(function(){i.activate()}).then(function(){var t=e.Node.create('<li class="comment-list-item"></li>');t.append(i.get("container")),n.commentsListNode.append(t),n.showCommentAddLoading(!1)}).then(function(){n.handleCommentViewAppended(i)})},handleCommentActionClick:function(e){var t=e.target,n=t.ancestor(".comment-item"),o=n.getAttribute("data-id");t.ancestor(".comment-action-menu-button",!0)&&this.showCommentActionMenu(o,n,t.ancestor(".comment-action-menu-button",!0).getAttribute("data-menutype")),t.ancestor(".comment-action-reply-button",!0)&&(e.preventDefault(),this.fire("subviewViewEvent",{eventName:"replyClicked",pathAliasOrNSID:t.ancestor(".comment-action-reply-button",!0).getAttribute("data-pathalias")}))},showCommentActionMenu:function(t,n,o){var i=this,m=[{text:this.intlMessage({intlName:"common.DELETE"}),value:"delete-comment-action"}];"owner"===o&&m.push({text:this.intlMessage({intlName:"common.EDIT"}),value:"edit-comment-action"}),n.addClass("active"),this.commentActionMenu||(this.commentActionMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnActionClick:!0,showDropArrow:!0,anchorElement:n.one(".comment-action-menu-button"),anchorOffsetHorizontal:11,classList:"over-modal comment-action-menu",overlayClassList:"over-modal",menuItems:m}),this.commentActionMenu.show(),this.registerEventHandler(this.commentActionMenu.on("closeDroparound",function(e){n.removeClass("active"),i.commentActionMenu=null})),this.registerEventHandler(this.commentActionMenu.on("selected",function(e){i.commentActionMenu.close(),"delete-comment-action"===e.menuItem.value?i.deleteComment(t,n):"edit-comment-action"===e.menuItem.value&&i.showEditComment(t,n)})))},deleteComment:function(e,t){return t.ancestor("li").remove(),this.deleteCommentCall(e)},deleteCommentCall:function(e){return"gallery"===this.modelConfig.type?this.deleteGalleryComment(e):"photo"===this.modelConfig.type?this.deletePhotoComment(e):void 0},showEditComment:function(e,t){var o=this,i=t.one(".content-container"),m=i.one(".comment-content");if(!this.isEditingComment)return this.isEditingComment=!0,this.commentModelRegistry.get(e).then(function(t){var s,l=m.get("offsetHeight");m.hide(),i.append(o.templates("comment-edit")({content:t.getValue("contentRaw")})),o.editCommentNode=i.one(".comment-edit"),(s=o.editCommentNode.one(".edit-field")).setStyle("height",Math.min(Math.max(l,100),200)),s.select(),o.registerEventHandler(o.editCommentNode.one(".cancel-edit-button").on("click",function(){m.show(),o.editCommentNode.remove(),o.isEditingComment=!1})),o.registerEventHandler(o.editCommentNode.one(".submit-edit-button").on("click",function(){o.updateComment(e,s.get("value"),m).then(function(e){m.set("innerHTML",e.getValue("contentSecure")),m.show(),o.editCommentNode.remove(),o.isEditingComment=!1}).catch(function(e){n.error("Error editing comment",{err:e}),m.show(),o.editCommentNode.remove(),o.isEditingComment=!1})}))})},updateComment:function(e,t){return this.updateCommentCall(e,t)},updateCommentCall:function(e,t){return"gallery"===this.modelConfig.type?this.updateGalleryComment(e,t):"photo"===this.modelConfig.type?this.updatePhotoComment(e,t):void 0},deleteGalleryComment:function(e){return this.commentModelRegistry.deleteRemote(e)},deletePhotoComment:function(e){var t=this;return this.commentModelRegistry.remoteDelete(e).then(function(){t.fire("subviewViewEvent",{eventName:"commentDeleted",commentModelId:e})})},updateGalleryComment:function(e,t){return this.commentModelRegistry.updateRemote(e,t)},updatePhotoComment:function(e,t){var n=this;return this.commentModelRegistry.get(e).then(function(o){return o.setValue("content",t),n.commentModelRegistry.remoteUpdate(e)})},delayPromise:function(t,n){return new e.Promise(function(e){setTimeout(function(){return e(n())},t)})},setLoading:function(e){this.isLoading=e},updateComments:function(e){},handleCommentViewAppended:function(){},showCommentLoading:function(){},showCommentAddLoading:function(){}})},"@VERSION@",{requires:["flickr-view","comment-item-view"],langBundles:["gallery","stats","comments","common"]});YUI.add("hermes-template-scrollable-comment-list-view",function(e,a){var s=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,s,t,l){var n=null!=a?a:{},i=s.helperMissing,m=e.escapeExpression;return'<div class="comment-list-container loading">\n\t<ol class="comment-list">\n\t</ol>\n\t<div class="loading-text">'+m((s.intlMessage||a&&a.intlMessage||i).call(n,{name:"intlMessage",hash:{intlName:"comments.LOADING_COMMENTS"},data:l}))+'</div>\n\t<div class="no-comments-text">'+m((s.intlMessage||a&&a.intlMessage||i).call(n,{name:"intlMessage",hash:{intlName:"comments.NO_COMMENTS"},data:l}))+"</div>\n</div>"},useData:!0}),t={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(t[a]=s)}),e.Template.register("hermes/scrollable-comment-list-view",function(a,l){return l=l||{},l.partials=l.partials?e.merge(t,l.partials):t,s(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("scrollable-comment-list-view",function(t,e){var s=require("hermes-core/flog")(e);t.namespace("Views")[this.name]=t.Base.create(this.name,t.Views["comment-list-view"],[],{langBundles:this.details.langBundles,initializer:function(t){this.constructor.superclass.initializer.call(this,t),this.listRegistryName=t.commentListConfig.listRegistryName,this.listId=t.commentListConfig.modelId},loadState:function(){var t=this;return t.appContext.getModel(t.listRegistryName,{id:t.listId}).then(function(e){t.commentListModel=e}).catch(function(t){throw s.error("Error getting comment list info",{err:t}),t})},buildContainer:function(){this.setContainerWithTemplate("scrollable-comment-list-view",this.params)},activate:function(){var t=this.get("container");this.listContainerNode=t.one(".comment-list-container"),this.scrollableEl=this.listContainerNode.getDOMNode(),this.registerEventHandler(this.commentListModel.on("valuesChanged",this.handleCommentListChange.bind(this),!0)),this.constructor.superclass.activate.call(this)},handleCommentListChange:function(t){0===t.comments.newVal.getList().length?this.showNoCommentsMessage():this.listContainerNode.removeClass("no-comments")},showNoCommentsMessage:function(){var t=this;this.listContainerNode.addClass("no-comments"),setTimeout(function(){t.fire("subviewViewEvent",{eventName:"emptyCommentContainer"})},300)},getNumOfComments:function(){return this.commentListModel.getValue(this.params.commentListConfig.collectionName).getList().length},setLoading:function(t){this.isLoading=t,this.listContainerNode.toggleClass("loading",t)},handleLoadCommentsComplete:function(){this.listContainerNode.removeClass("loading"),0===this.getNumOfComments()&&this.showNoCommentsMessage(),this.scrollableEl.scrollTop=this.scrollableEl.scrollHeight,this.registerEventHandler(this.listContainerNode.on("scroll",this.handleCommentsScroll.bind(this)))},appendNewComment:function(t){0===this.getNumOfComments()&&this.listContainerNode.removeClass("no-comments"),this.constructor.superclass.appendNewComment.call(this,t)},handleCommentsScroll:function(t){!this.isFetchingComments&&this.scrollableEl.scrollTop<=0&&this.getMoreComments()},showCommentLoading:function(t){t?this.showBalls(!1):this.hideBalls()},showCommentAddLoading:function(t){t?(this.showBalls(!0),this.scrollableEl.scrollTop=this.scrollableEl.scrollHeight):this.hideBalls()},handleCommentViewAppended:function(t){this.scrollableEl.scrollTop=this.scrollableEl.scrollHeight},updateComments:function(t){var e=this;return t.forEach(function(t){e.renderedCommentModels.push(t)}),this.prependComments(t)},prependComments:function(e){var s=this,i=[],n=[];return e.forEach(function(e){var o=e.toJSON(),l=Object.assign(o,{appContext:this.appContext});l.isSubjectOwner=s.isSubjectOwner;var a=new t.Views["comment-item-view"](l),m=a.initialize(l).then(function(){a.activate()});n.push(a),i.push(m)}),t.Promise.all(i).then(function(){s.prependCommentViewsToDom(n)})},prependCommentViewsToDom:function(e){var s,i=this,n=this.scrollableEl,o=n.scrollHeight,l=n.scrollTop;e.forEach(function(e){(s=t.Node.create('<li class="comment-list-item"></li>')).append(e.get("container")),i.commentsListNode.prepend(s)}),n.scrollTop=n.scrollHeight-o+l}})},"@VERSION@",{requires:["flickr-view","comment-list-view","hermes-template-scrollable-comment-list-view"],langBundles:["common","comments"]});YUI.add("hermes-template-photo-comments-view",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,n,s){var l=null!=t?t:{},o=a.helperMissing,i=e.escapeExpression;return'<section class="comments-list-section">\n\t'+i((a.outlet||t&&t.outlet||o).call(l,null!=t?t["scrollable-comment-list-view"]:t,{name:"outlet",hash:{},data:s}))+'\n</section>\n\n<section class="add-comment-section">\n\t'+i((a.outlet||t&&t.outlet||o).call(l,null!=t?t["add-comment-view"]:t,{name:"outlet",hash:{},data:s}))+"\n</section>\n"},useData:!0}),n={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)}),e.Template.register("hermes/photo-comments-view",function(t,s){return s=s||{},s.partials=s.partials?e.merge(n,s.partials):n,a(t,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-comment-edit",function(t,e){var n=t.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(t,e,n,a,s){var i,l=null!=e?e:{},m=n.helperMissing,o=t.escapeExpression;return'<div class="comment-edit">\n\t<textarea class="edit-field">'+o("function"==typeof(i=null!=(i=n.content||(null!=e?e.content:e))?i:m)?i.call(l,{name:"content",hash:{},data:s}):i)+'</textarea>\n\t<div class="buttons edit-comment-buttons">\n\t\t<button type="button" class="mini alt cancel-edit-button">'+o((n.intlMessage||e&&e.intlMessage||m).call(l,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:s}))+'</button>\n\t\t<button type="button" class="mini action submit-edit-button">'+o((n.intlMessage||e&&e.intlMessage||m).call(l,{name:"intlMessage",hash:{intlName:"common.DONE"},data:s}))+"</button>\n\t</div>\n</div>"},useData:!0}),a={};t.Array.each([],function(e){var n=t.Template.get("hermes/"+e);n&&(a[e]=n)}),t.Template.register("hermes/comment-edit",function(e,s){return s=s||{},s.partials=s.partials?t.merge(a,s.partials):a,n(e,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});